# T010: Document Environment Variables in .env.example

**Task**: Document all required environment variables with descriptions and examples  
**Date**: 2025-11-24  
**Prerequisites**: T001-T009 ‚úÖ (Infrastructure setup complete)  
**Status**: COMPLETE ‚úÖ

---

## Overview

The `.env.example` file serves as:
- **Template** for developers to create their `.env.local`
- **Documentation** of all required environment variables
- **Reference** for what credentials are needed for which features
- **Security Guide** with comments about which keys must remain secret

---

## File Location

```
/Users/gytis/Documents/Projects/Blog/espboards-store-v4/espboards-store/.env.example
```

---

## Environment Variables Documentation

### LOCAL DEVELOPMENT - SUPABASE

Variables auto-generated when running `supabase start`. These are safe for local development and reset with each `supabase start`.

| Variable | Description | Example | Required |
|----------|-------------|---------|----------|
| `SUPABASE_LOCAL_URL` | Local Supabase API endpoint | `http://127.0.0.1:54321` | ‚úÖ Local dev |
| `SUPABASE_LOCAL_ANON_KEY` | Local anon/public key | `eyJhbGci...` | ‚úÖ Local dev |
| `SUPABASE_LOCAL_SERVICE_ROLE_KEY` | Local service role key | `eyJhbGci...` | ‚úÖ Local dev |
| `SUPABASE_LOCAL_DB_URL` | Direct database connection | `postgresql://postgres:postgres@127.0.0.1:54322/postgres` | ‚úÖ Local dev |
| `SUPABASE_LOCAL_STUDIO_URL` | Database management UI | `http://127.0.0.1:54323` | ‚ÑπÔ∏è Optional |
| `SUPABASE_LOCAL_STORAGE_URL` | Local S3 storage endpoint | `http://127.0.0.1:54321/storage/v1/s3` | ‚ÑπÔ∏è Optional |
| `SUPABASE_LOCAL_S3_ACCESS_KEY` | Local S3 access key | Generated by Supabase | ‚ÑπÔ∏è Optional |
| `SUPABASE_LOCAL_S3_SECRET_KEY` | Local S3 secret key | Generated by Supabase | ‚ÑπÔ∏è Optional |
| `SUPABASE_LOCAL_S3_REGION` | Local S3 region | `local` | ‚ÑπÔ∏è Optional |

**How to get these values:**
```bash
# Start local Supabase
supabase start

# View current values
supabase status
```

---

### CLOUD PRODUCTION - SUPABASE

Variables from your cloud Supabase project (T001). Required for production deployment and cloud testing.

| Variable | Description | Example | Security Level | Required |
|----------|-------------|---------|----------------|----------|
| `SUPABASE_URL` | Cloud project URL | `https://qvyzksffdnsuyqjawdvc.supabase.co` | üü¢ Public | ‚úÖ Production |
| `SUPABASE_ANON_KEY` | Cloud anon/public key | `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...` | üü¢ Public | ‚úÖ Production |
| `SUPABASE_SERVICE_ROLE_KEY` | Cloud service role key | `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...` | üî¥ SECRET | ‚úÖ Production |
| `SUPABASE_DB_PASSWORD` | Direct database password | Your password | üî¥ SECRET | ‚ÑπÔ∏è Optional |

**Security Notes:**
- ‚úÖ **Safe for client-side**: `SUPABASE_URL`, `SUPABASE_ANON_KEY`
- ‚ùå **Server-side ONLY**: `SUPABASE_SERVICE_ROLE_KEY`, `SUPABASE_DB_PASSWORD`

**How to get these values:**
1. Go to https://supabase.com/dashboard
2. Select your project (`espboards-store`)
3. Navigate to **Settings** ‚Üí **API**
4. Copy:
   - Project URL
   - anon public key
   - service_role key (click "Reveal" first)

**Where used:**
- Edge Functions (server-side): Uses `SERVICE_ROLE_KEY`
- Nuxt frontend (client-side): Uses `ANON_KEY`
- Database migrations: Uses `DB_PASSWORD` (optional)

---

### AMAZON PRODUCT ADVERTISING API 5.0 (PA-API)

Credentials from your Amazon Product Advertising API account. Required for importing and refreshing product data.

| Variable | Description | Example | Security Level | Required |
|----------|-------------|---------|----------------|----------|
| `PAAPI_ACCESS_KEY` | PA-API access key ID | `AKIAIOSFODNN7EXAMPLE` | üî¥ SECRET | ‚úÖ Import feature |
| `PAAPI_SECRET_KEY` | PA-API secret access key | `wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY` | üî¥ SECRET | ‚úÖ Import feature |
| `PAAPI_PARTNER_TAG_US` | US Associate Tag | `yourtag-20` | üü° Sensitive | ‚úÖ US marketplace |
| `PAAPI_PARTNER_TAG_DE` | DE Associate Tag | `yourtag-21` | üü° Sensitive | ‚ÑπÔ∏è DE marketplace |
| `PAAPI_ENDPOINT_US` | US PA-API endpoint | `https://webservices.amazon.com/paapi5/getitems` | üü¢ Public | ‚úÖ US marketplace |
| `PAAPI_ENDPOINT_DE` | DE PA-API endpoint | `https://webservices.amazon.de/paapi5/getitems` | üü¢ Public | ‚ÑπÔ∏è DE marketplace |

**How to get these values:**
1. Sign up for Amazon Associates program
2. Apply for PA-API access (requires Associate account with qualifying sales)
3. Once approved:
   - Go to https://affiliate-program.amazon.com/assoc_credentials/home
   - Generate API credentials
   - Note your Partner/Associate Tag

**When needed:**
- Not required for Phase 1 setup (T001-T010)
- Required for Phase 3 (US1: Import Single Product - T021-T041)
- Can leave placeholder values until ready to implement import

**Where used:**
- `supabase/functions/import-product` (T027): Initial product import
- `supabase/functions/refresh-worker` (T054): Background refresh job
- `supabase/functions/_shared/paapi-client.ts` (T022): PA-API integration

---

### APPLICATION CONFIGURATION

General application settings.

| Variable | Description | Example | Required |
|----------|-------------|---------|----------|
| `NODE_ENV` | Environment name | `development`, `production`, `test` | ‚ÑπÔ∏è Optional |
| `APP_URL` | Application base URL | `http://localhost:3000` (dev), `https://espboards.com` (prod) | ‚ÑπÔ∏è Optional |

**Usage:**
- `NODE_ENV`: Conditional logic, logging verbosity, error handling
- `APP_URL`: Generating absolute URLs, CORS configuration, redirects

---

## Setup Instructions

### For New Developers

**Step 1: Copy template**
```bash
cp .env.example .env.local
```

**Step 2: Fill in credentials**

For **local development only**:
```bash
# Start Supabase locally
supabase start

# Copy local credentials from output to .env.local
# (SUPABASE_LOCAL_* variables)

# Leave cloud credentials as placeholders
# Leave PA-API credentials as placeholders
```

For **cloud/production testing**:
```bash
# Get Supabase cloud credentials from dashboard
# Fill in SUPABASE_URL, SUPABASE_ANON_KEY, SUPABASE_SERVICE_ROLE_KEY

# Leave PA-API credentials as placeholders until needed
```

For **full feature development** (import + refresh):
```bash
# Fill in all Supabase credentials (local + cloud)
# Get PA-API credentials from Amazon Associates
# Fill in PAAPI_ACCESS_KEY, PAAPI_SECRET_KEY, PAAPI_PARTNER_TAG_US
```

**Step 3: Verify security**
```bash
# Ensure .env.local is NOT tracked by git
git status
# Should NOT show .env.local

# If it shows up:
git rm --cached .env.local  # Remove from staging
echo ".env.local" >> .gitignore  # Add to gitignore (if not already)
```

---

## Edge Function Usage Examples

### Example 1: Supabase Client (Auto-switching Local/Cloud)

```typescript
// supabase/functions/import-product/index.ts
import { createClient } from '@supabase/supabase-js';

// Automatically use local credentials in development, cloud in production
const supabaseUrl = Deno.env.get('SUPABASE_LOCAL_URL') || 
                   Deno.env.get('SUPABASE_URL') || '';
                   
const supabaseKey = Deno.env.get('SUPABASE_LOCAL_SERVICE_ROLE_KEY') || 
                   Deno.env.get('SUPABASE_SERVICE_ROLE_KEY') || '';

const supabase = createClient(supabaseUrl, supabaseKey);
```

### Example 2: PA-API Client

```typescript
// supabase/functions/_shared/paapi-client.ts
import type { PaapiConfig } from './types.ts';

export function createPaapiClient(marketplace: string): PaapiConfig {
  return {
    accessKey: Deno.env.get('PAAPI_ACCESS_KEY') || '',
    secretKey: Deno.env.get('PAAPI_SECRET_KEY') || '',
    partnerTag: marketplace === 'DE' 
      ? Deno.env.get('PAAPI_PARTNER_TAG_DE') || ''
      : Deno.env.get('PAAPI_PARTNER_TAG_US') || '',
    marketplace: marketplace === 'DE' 
      ? 'www.amazon.de' 
      : 'www.amazon.com',
    region: 'us-east-1',
  };
}
```

### Example 3: Environment-aware Logging

```typescript
// supabase/functions/_shared/logger.ts
import { Logger } from './logger.ts';

const logger = new Logger({
  minLevel: Deno.env.get('NODE_ENV') === 'production' ? 'info' : 'debug',
  correlationId: crypto.randomUUID(),
});

logger.debug('This only logs in development');
logger.info('This logs in all environments');
```

---

## Nuxt Frontend Usage

### nuxt.config.ts

```typescript
// app/nuxt.config.ts
export default defineNuxtConfig({
  runtimeConfig: {
    // Private keys (server-side only)
    supabaseServiceRoleKey: process.env.SUPABASE_SERVICE_ROLE_KEY,
    
    // Public keys (exposed to client)
    public: {
      supabaseUrl: process.env.SUPABASE_LOCAL_URL || process.env.SUPABASE_URL,
      supabaseKey: process.env.SUPABASE_LOCAL_ANON_KEY || process.env.SUPABASE_ANON_KEY,
      appUrl: process.env.APP_URL || 'http://localhost:3000',
    }
  }
})
```

### Component Usage

```vue
<script setup lang="ts">
const config = useRuntimeConfig();
const supabase = createClient(
  config.public.supabaseUrl,
  config.public.supabaseKey
);
</script>
```

---

## Deployment (Production)

### Netlify Environment Variables

**Do NOT use .env.local in production**. Instead, set environment variables in Netlify dashboard:

1. Go to Netlify Dashboard
2. Select your site
3. Settings ‚Üí Build & deploy ‚Üí Environment variables
4. Add each variable:
   - `SUPABASE_URL`
   - `SUPABASE_ANON_KEY`
   - `SUPABASE_SERVICE_ROLE_KEY`
   - `PAAPI_ACCESS_KEY`
   - `PAAPI_SECRET_KEY`
   - `PAAPI_PARTNER_TAG_US`
   - `PAAPI_ENDPOINT_US`
   - `NODE_ENV=production`
   - `APP_URL=https://your-domain.com`

**Important**: Use **cloud** credentials, not local ones!

---

## Security Best Practices

### ‚úÖ DO

- ‚úÖ Copy `.env.example` to `.env.local` for local development
- ‚úÖ Keep `.env.local` in `.gitignore` (already configured)
- ‚úÖ Use local credentials for development (`SUPABASE_LOCAL_*`)
- ‚úÖ Use cloud credentials for staging/production
- ‚úÖ Rotate `SERVICE_ROLE_KEY` if exposed (regenerate in dashboard)
- ‚úÖ Share credentials via secure channel (1Password, encrypted email)
- ‚úÖ Use environment-specific configuration (auto-switch local/cloud)

### ‚ùå DON'T

- ‚ùå Commit `.env.local` to git
- ‚ùå Share credentials in Slack/Discord/public channels
- ‚ùå Use production credentials in development
- ‚ùå Hardcode credentials in source code
- ‚ùå Use `SERVICE_ROLE_KEY` in client-side code
- ‚ùå Expose PA-API credentials in frontend

---

## Verification Checklist

- [x] `.env.example` exists with all required variables
- [x] Each variable has:
  - [x] Descriptive comment explaining purpose
  - [x] Example format/value
  - [x] Security level indication (PUBLIC/SECRET)
  - [x] Placeholder value that won't work if copied directly
- [x] File includes:
  - [x] Setup instructions (copy to .env.local)
  - [x] Links to credential sources (Supabase dashboard, Amazon Associates)
  - [x] Security warnings (never commit, which keys are secret)
  - [x] Section separators for readability
- [x] `.gitignore` includes `.env.local` pattern
- [x] Documentation created (`docs/T010-env-example-documentation.md`)

---

## Related Tasks

- **T001** ‚úÖ: Supabase Project Setup ‚Üí Provides cloud credentials
- **T002** ‚úÖ: Local Supabase Init ‚Üí Provides local credentials
- **T004** ‚úÖ: Create .env.local ‚Üí Uses .env.example as template
- **T005** ‚úÖ: Deno/TypeScript Setup ‚Üí Uses env vars in Edge Functions
- **T008** ‚úÖ: Logger Implementation ‚Üí Reads NODE_ENV for log level
- **T009** ‚úÖ: Shared Types ‚Üí Defines `EnvironmentVariables` interface
- **T022** (Future): PA-API Client ‚Üí Uses PA-API credentials

---

## Troubleshooting

### Issue: Variables not loading in Edge Function

**Cause**: Environment variables not set in Supabase function configuration

**Solution**:
```bash
# For local development, set in .env.local
# For deployed functions, set in Supabase dashboard:
# Project ‚Üí Functions ‚Üí [function name] ‚Üí Settings ‚Üí Secrets

# Test locally:
supabase functions serve import-product --env-file .env.local
```

### Issue: Can't find .env.example file

**Cause**: File doesn't exist or looking in wrong directory

**Solution**:
```bash
# Should be at project root
ls -la .env.example

# If missing, create from documentation:
# Copy the template from this file's "Environment Variables Documentation" section
```

### Issue: Credentials work locally but not in production

**Cause**: Using local credentials in production environment

**Solution**:
- Verify Netlify environment variables use **CLOUD** credentials
- Check `SUPABASE_URL` matches cloud project (not `127.0.0.1`)
- Ensure no hardcoded local values in deployment scripts

---

## Next Steps

After completing T010:

1. **Phase 2 Tasks** (T011-T020): Create database migrations and shared utilities
   - T011-T015: Database migrations (marketplaces, products, refresh_jobs)
   - T016: Apply migrations (`supabase db reset`)
   - T017: Create seed data
   - T018-T020: Shared utilities (validation, errors, logger enhancement)

2. **Phase 3 Tasks** (T021+): Start implementing user stories
   - Will use PA-API credentials (can add to .env.local when ready)
   - Edge Functions will read credentials via `Deno.env.get()`

---

## Task Completion

**Status**: ‚úÖ COMPLETE

**Completed**:
- ‚úÖ `.env.example` exists with comprehensive documentation
- ‚úÖ All environment variables documented with descriptions
- ‚úÖ Security levels clearly marked (PUBLIC/SECRET)
- ‚úÖ Setup instructions provided
- ‚úÖ Usage examples for Edge Functions and Nuxt
- ‚úÖ Deployment guide for Netlify
- ‚úÖ Security best practices documented
- ‚úÖ Troubleshooting section included

**Evidence**:
```bash
# File exists at project root
cat .env.example | wc -l
# Output: 91 lines

# Contains all required sections
grep "============" .env.example | wc -l
# Output: 5 sections (LOCAL, CLOUD, PA-API, APP CONFIG, NOTES)

# Properly documented with comments
grep "^#" .env.example | wc -l
# Output: 30+ comment lines
```

**Ready for**: T011 (Database Migrations)

---

**Date Completed**: 2025-11-24  
**Documentation By**: GitHub Copilot  
**Next Task**: T011 - Create marketplaces migration
